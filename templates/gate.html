<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Scanner</title>
    <link rel="shortcut icon" href="#">
    <script src="/static/js/qr-scanner.umd.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" 
       href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.css">
    <script 
      src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.js">
    </script>

</head>
<body>
<style>
    .square {
        height: 100px;
        width: 100px;
        background-color: red;
    }
    hr {
        margin-top: 32px;
    }
    div {
        margin-bottom: 5px;
    }
</style>
<h1>Please scan your QR</h1>
<div>
    <button class="ui button" id="buttonscan">Click to scan QR code</button>
    <div class="ui active inline text loader" id="loading">Checking QR Code</div>
    <div class="square">HELLO</div>
</div>
<video id="qr-video" style="width: 400px;height: 400px;" ></video>






<script type="module">;
    QrScanner.WORKER_PATH = '/static/js/qr-scanner-worker.min.js';
    const video = document.getElementById('qr-video');   
    const camQrResult = document.getElementById('cam-qr-result');
    
    
    $(document).ready(function(){
        $("#loading").hide();
    });
    
    
    function setResult(result) {
        console.log("Decoded:", result);
        console.log(Date().toString());
        scanner.stop();
        $("#loading").show();
        //Send Data
        const url = '/sendkey';

        $.post(url, {
            id: 1,
            code: result
        }, 
        function(data, status) {
            $("#loading").hide();
            $("#buttonscan").show();
            console.log("Response:",data);
        });
        //change to green or red screen

    }

    const scanner = new QrScanner(video, result => setResult(result));
    
    $("#buttonscan").click(function(){
        $("#buttonscan").hide();
        scanner.start();
    });
    


</script>
</body>
</html>